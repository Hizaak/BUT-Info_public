# -*- coding: utf-8 -*-
"""
Created on Tue Mar 15 11:01:27 2022

@author: gtritsch
"""

import pandas
import numpy
import pyodbc
import matplotlib.pyplot as plt

conn = pyodbc.connect('DSN=data')
cursor=conn.cursor()

cursor.execute(
f"""

SELECT COUNT(*)/5202 FROM view_all

""")


for row in cursor.fetchall():
    moyenne = row[0]
   
    
listabs = []
cursor.execute(
f"""

SELECT COUNT(*),YEAR(`view_all`.`date`), MONTH(`view_all`.`date`) FROM `view_all` GROUP BY YEAR(`view_all`.`date`),MONTH(`view_all`.`date`)

""")


for row in cursor.fetchall():
    listabs.append(float(row[0]))

print (len(listabs))
print (moyenne)

print (listabs)

#lissage pourri
"""for i in range(30,len(listabs)-32):
    somme=0
    for j in range(i-30,i+30):
        somme+=listabs[j]
        listabs[i]=(listabs[i-1]+listabs[i]+listabs[i+1])/3
        """

e = [i for i in range (366)]
val=listabs

dataframe = pandas.DataFrame({'Value':listabs})
axis = dataframe.plot(rot=0)
print(axis)
plt.show()

cursor.execute(
f"""

SELECT COUNT(*)/14 FROM `view_all` GROUP BY MONTH(`view_all`.`date`)

""")
listabs=[]
for row in cursor.fetchall():
    listabs.append(float(row[0]-moyenne))



e = [i for i in range (366)]
val=listabs

dataframe = pandas.DataFrame({'Value':listabs})
axis = dataframe.plot(legend=False)
plt.title("Moyenne du nombre d'accidents sur 14 ans en fonction du mois dans l'ann√©e")
print(axis)
plt.xlabel("Semaines")
plt.ylabel("Nombre d'accidents")
plt.show()